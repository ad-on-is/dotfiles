<meta http-equiv="content-type" content="text/html; charset=utf-8"><pre class="phiki language-php github-light" data-language="php" style="background-color: #fff;color: #24292e;"><code><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Inspired from https://gist.github.com/vuon9/be16429f751e12f72e220c18777d9bc7</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> This script will</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;">   1. Read the file contents provided by STDIN</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;">   2. Create a temporary file (tries multiple directories)</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;">   3. Call PHP-CS-Fixer's "fix" command with path to the temp file</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;">   4. provides the fixed file contents as STDOUT</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">function</span><span class="token"> </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #d73a49;">string</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">message</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #d73a49;">int</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">code</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">1</span><span class="token">)</span><span class="token" style="color: #d73a49;">:</span><span class="token"> </span><span class="token" style="color: #d73a49;">void</span><span class="token">
</span></span><span class="line"><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #005cc5;">fwrite</span><span class="token">(</span><span class="token" style="color: #005cc5;">STDERR</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">message</span><span class="token"> </span><span class="token" style="color: #d73a49;">.</span><span class="token"> </span><span class="token" style="color: #005cc5;">PHP_EOL</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #d73a49;">exit</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">code</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Read file contents from STDIN</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">fileContents</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">file_get_contents</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">php://stdin</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">fileContents</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">trim</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">fileContents</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Create temp file and save STDIN contents</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tryTmpDirs</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token">[</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #005cc5;">sys_get_temp_dir</span><span class="token">(</span><span class="token">)</span><span class="token">,</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">.tmp</span><span class="token" style="color: #032f62;">'</span><span class="token">,</span><span class="token">
</span></span><span class="line"><span class="token">]</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">createdTempFile</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">false</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">foreach</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tryTmpDirs</span><span class="token"> </span><span class="token" style="color: #d73a49;">as</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpDir</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">ok</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">is_dir</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpDir</span><span class="token">)</span><span class="token"> </span><span class="token" style="color: #d73a49;">||</span><span class="token"> </span><span class="token" style="color: #005cc5;">mkdir</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpDir</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #005cc5;">0777</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #005cc5;">true</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #005cc5;">false</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">ok</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">        </span><span class="token" style="color: #d73a49;">continue</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">tempnam</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpDir</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">fix_</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #005cc5;">false</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">        </span><span class="token" style="color: #d73a49;">continue</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">ok</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">file_put_contents</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">fileContents</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #005cc5;">false</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">ok</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">        </span><span class="token" style="color: #d73a49;">continue</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">createdTempFile</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">true</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token"> </span><span class="token" style="color: #d73a49;">!</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">createdTempFile</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">could not save STDIN to temp file</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Check if PHP-CS-Fixer is installed</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">whichBinary</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">exec</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">which php-cs-fixer</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">'</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">whichBinary</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">php-cs-fixer binary not found in $PATH folders</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">cmd</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">sprintf</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">php-cs-fixer --quiet fix %s</span><span class="token" style="color: #032f62;">'</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Run the command</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">output</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token">[</span><span class="token">]</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">returnCode</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">0</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #005cc5;">exec</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">cmd</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">output</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">returnCode</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">returnCode</span><span class="token"> </span><span class="token" style="color: #d73a49;">&gt;</span><span class="token"> </span><span class="token" style="color: #005cc5;">0</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #005cc5;">implode</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;"> </span><span class="token" style="color: #032f62;">'</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">output</span><span class="token">)</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">returnCode</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #6a737d;">//</span><span class="token" style="color: #6a737d;"> Return new contents to STDOUT</span><span class="token" style="color: #6a737d;">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">newContents</span><span class="token"> </span><span class="token" style="color: #d73a49;">=</span><span class="token"> </span><span class="token" style="color: #005cc5;">file_get_contents</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #005cc5;">false</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">newContents</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">couldnt read from temp file after fixing</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token"> </span><span class="token" style="color: #d73a49;">!</span><span class="token"> </span><span class="token" style="color: #005cc5;">empty</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">newContents</span><span class="token">)</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #005cc5;">fwrite</span><span class="token">(</span><span class="token" style="color: #005cc5;">STDOUT</span><span class="token">,</span><span class="token"> </span><span class="token" style="color: #005cc5;">trim</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">newContents</span><span class="token">)</span><span class="token"> </span><span class="token" style="color: #d73a49;">.</span><span class="token"> </span><span class="token" style="color: #005cc5;">PHP_EOL</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span><span class="token">
</span></span><span class="line"><span class="token">
</span></span><span class="line"><span class="token" style="color: #d73a49;">if</span><span class="token"> </span><span class="token">(</span><span class="token" style="color: #005cc5;">false</span><span class="token"> </span><span class="token" style="color: #d73a49;">===</span><span class="token"> </span><span class="token" style="color: #d73a49;">@</span><span class="token" style="color: #005cc5;">unlink</span><span class="token">(</span><span class="token" style="color: #24292e;">$</span><span class="token" style="color: #24292e;">tmpFile</span><span class="token">)</span><span class="token">)</span><span class="token"> </span><span class="token">{</span><span class="token">
</span></span><span class="line"><span class="token">    </span><span class="token" style="color: #6f42c1;">error_exit</span><span class="token">(</span><span class="token" style="color: #032f62;">'</span><span class="token" style="color: #032f62;">couldnt delete temp file</span><span class="token" style="color: #032f62;">'</span><span class="token">)</span><span class="token">;</span><span class="token">
</span></span><span class="line"><span class="token">}</span></span></code></pre>